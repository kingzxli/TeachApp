<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.song.mapper.OrderMapper">

	<select id="selctByPopenid" parameterType="java.lang.String" resultType="com.song.pojo.Order">
		select * from orders where popenid=#{openid}
	</select>

	<insert id="insert" parameterType="com.song.pojo.Order">
		insert into orders (isbd,orderpar,popenid,username,tel,ordernum,addtime,price,openId,totalfee,body,times,tid,addr,num,totalnum,totalprice,types,status,comment,name,image)
		 values (#{isbd},#{orderpar},#{popenid},#{username},#{tel},#{ordernum},#{addtime},#{price},#{openId},#{totalfee},#{body},#{times},#{tid},#{addr},#{num},#{totalnum},#{totalprice},
		 			#{types},#{status},#{comment},#{name},#{image})
	</insert>
	
	<select id="selectByOpenid" parameterType="java.lang.String" resultType="com.song.pojo.Order">
		select * from orders where openId=#{openid}
	</select>
	
	<update id="updateStatus" parameterType="java.lang.String">
		update orders set status=#{status} where ordernum=#{ordernum}
	</update>
	
	<select id="selectByOrderNum" parameterType="java.lang.String" resultType="com.song.pojo.Order">
		select * from orders o where ordernum=#{ordernum}
	</select>
	
	<select id="selectByStatus" parameterType="java.lang.String" resultType="com.song.pojo.Order">
		select * from orders where status='待支付' and openId=#{openid} and types != '标准支付'
	</select>
	
	<select id="selectAll" parameterType="java.lang.String" resultType="com.song.pojo.Order">
		select * from orders where openId=#{openid} order by id desc
	</select>
	
	<select id="selectByOrder" parameterType="java.lang.String" resultType="com.song.pojo.Order">
		select * from orders where ordernum=#{ordernum}
	</select>
	
	<select id="selectByComment" parameterType="java.lang.String" resultType="com.song.pojo.Order">
		select * from orders where openId=#{openid} and comment='否' and status='已支付'
	</select>
	
	<select id="selectByComment2" parameterType="java.lang.String" resultType="com.song.pojo.Order">
		select * from orders where openId=#{openid} and comment='是' and status='已支付'
	</select>
	
	<update id="updateComment" parameterType="java.lang.String">
		update orders set comment='是' where ordernum=#{ordernum}
	</update>
	
	<select id="selectParByTea" parameterType="java.lang.Integer" resultType="com.song.pojo.Order">
		select * from orders o,parent p where o.tid = #{tid} and
		p.openid in (select os.openId from orders os where os.status='已支付' and os.timestatus='进行中' and os.tid=#{tid})
	</select>
	
	<select id="selectTeaByPar" parameterType="java.lang.String" resultType="com.song.pojo.Teacher">
		select t.* from orders o,teacher t where o.status='已支付' and o.timestatus='进行中' and o.tid = t.id and o.openid=#{openid}
	</select>
	
	<delete id="delete" parameterType="java.lang.Integer">
		delete from orders where id=#{id}
	</delete>
	
	<!-- <resultMap type="Order" id="OrderMap">
		<id column="id" property="id"/>
		<result column="ordernum" property="ordernum"/>
		<collection property="parent" ofType="Parent">
			<id column="id" property="id"/>
			<result column="name" property="name"/>
		</collection>
	</resultMap> -->
	<select id="selectbytid" parameterType="java.lang.Integer" resultType="com.song.pojo.Order">
		<!-- select o.*,p.* from orders o,parent p where o.openId = p.openid and o.tid=#{tid} and timestatus='进行中' -->
		select o.* from orders o where o.tid=#{tid} and timestatus='进行中' and status='已支付'
	</select>
	
	<update id="updateTimeStatus" parameterType="java.lang.String">
		update orders set timestatus=#{timestatus} where ordernum=#{ordernum}
	</update>
	
	<delete id="deleteByOrdernum" parameterType="com.song.pojo.Order">
		delete from orders where ordernum = #{ordernum}
	</delete>
	
	<select id="selectByBdAll" parameterType="com.song.pojo.Order" resultType="com.song.pojo.Order">
		select * from orders where isbd = 1
		<if test="ordernum != null and order !=''">
			and ordernum = #{ordernum}
		</if>
		<if test="openId != null and openId !=''">
			and openId = #{openId}
		</if>
	</select>
	
	
</mapper>