<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.song.mapper.OrderMapper">


	<select id="selectStatus" parameterType="Order" resultType="Order">
		select * from orders where status = #{status} and isbd = #{isbd}
		 order by addtime desc
	</select>
	
	<insert id="insert" parameterType="Order">
		insert into orders (popenid,username,tel,ordernum,addtime,price,openId,totalfee,body,times,tid,addr,num,totalnum,totalprice,types,status,comment,name,image)
		 values (#{popenid},#{username},#{tel},#{ordernum},#{addtime},#{price},#{openId},#{totalfee},#{body},#{times},#{tid},#{addr},#{num},#{totalnum},#{totalprice},
		 			#{types},#{status},#{comment},#{name},#{image})
	</insert>
	
	<select id="selectByOpenid" parameterType="String" resultType="Order">
		select * from orders where openId=#{openid}
	</select>
	
	<update id="updateStatus" parameterType="String">
		update orders set status=#{status} where ordernum=#{ordernum}
	</update>
	
	<select id="selectByOrderNum" parameterType="String" resultType="Order">
		select * from orders where ordernum=#{ordernum}
	</select>
	
	<select id="selectByStatus" parameterType="String" resultType="Order">
		select * from orders where status='待支付' and openId=#{openid}
	</select>
	
	<select id="selectAll" parameterType="String" resultType="Order">
		select * from orders where openId=#{openid}
	</select>
	
	<select id="selectByOrder" parameterType="String" resultType="Order">
		select * from orders where ordernum=#{ordernum}
	</select>
	
	<select id="selectByComment" parameterType="String" resultType="Order">
		select * from orders where openId=#{openid} and comment='否' and status='已支付'
	</select>
	
	<select id="selectByComment2" parameterType="String" resultType="Order">
		select * from orders where openId=#{openid} and comment='是' and status='已支付'
	</select>
	
	<update id="updateComment" parameterType="String">
		update orders set comment='是' where ordernum=#{ordernum}
	</update>
	
	<select id="selectParByTea" parameterType="int" resultType="Order">
		select * from orders o,parent p where o.status='已支付' and o.timestatus='进行中' and o.openId = p.openid and o.openId= any(select openId from orders where tid=#{tid})
	</select>
	
	<select id="selectTeaByPar" parameterType="String" resultType="Teacher">
		select t.* from orders o,teacher t where o.status='已支付' and o.timestatus='进行中' and o.tid = t.id and o.popenid=#{openid}
	</select>
	
	<delete id="delete" parameterType="int">
		delete from orders where id=#{id}
	</delete>
	
	<!-- <resultMap type="Order" id="OrderMap">
		<id column="id" property="id"/>
		<result column="ordernum" property="ordernum"/>
		<collection property="parent" ofType="Parent">
			<id column="id" property="id"/>
			<result column="name" property="name"/>
		</collection>
	</resultMap> -->
	<select id="selectbytid" parameterType="int" resultType="Order">
		<!-- select o.*,p.* from orders o,parent p where o.openId = p.openid and o.tid=#{tid} and timestatus='进行中' -->
		select o.* from orders o where o.tid=#{tid} and timestatus='进行中' and status='已支付'
	</select>
	
	<update id="updateTimeStatus" parameterType="String">
		update orders set timestatus=#{timestatus} where ordernum=#{ordernum}
	</update>
	
</mapper>